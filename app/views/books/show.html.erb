<div class="bl-book-page">
	<% if user_signed_in? %>
		<%# This will check if the user is reading the book and display options %>
		<% if Book.where(:user_id => current_user.id).where(:olidb => params[:id]).exists? %>
		<div class="rec" align="right">
				<%= button_to "Recommend", {:controller => :books, :action => 'recommended_list', :id => @mybook[0].id}, :method => :post, :class => "btn"%>
		
	<% end %>
	<% else %>
	<% end %>
				 
 	</div>
	<div align="center">
		<h2><%= @thebook.work.original_title %></h2>
		<h4>BY</h4>
		<h3>
			<% if @thebook.authors.author[0].blank? %>
				<%= link_to @thebook.authors.author.name, author_book_path(@thebook.authors.author.id) %>
			<% else %>
				<%= @thebook.authors.author.collect{ |f| link_to f.name, author_book_path(f.id)}.to_sentence.html_safe %></h3>
			<% end%>
	</div>
	
	<div class="b-cover" align="center">
		<%= (image_tag ("http://content-3.powells.com/cgi-bin/imageDB.cgi?isbn=#{@thebook.isbn}"), :class=>"book-cover")%>
	</div>
	
	<h4>Book status:</h4>
	<div class="bookstatus" align="center">
	<ul class="inline">
	<%# Is the user signed in?%>
	<% if user_signed_in? %>
		<%# This will check if the user is reading the book and display options %>
		<li><% if Book.where(:user_id => current_user.id).where(:olidb => params[:id]).exists? %>
		
			<% if @mybook[0].status == 1 %>
				You've already finished this book.
			<% end %>
		<ul class="inline">
			<li>
			<% if @mybook[0].status == 0 %>
				<%= button_to "Abandon it", {:controller => :books, :action => 'destroy', :id => @mybook[0].id}, :method => :delete, :class => "btn", :confirm => "Are you sure?" %>		
			</li>
			<li>
				<%= button_to "Finished!", {:controller => :books, :action => 'update', :id => @mybook[0].id}, :method => :put, :class => "btn", :confirm => "Are you sure?" %>
			</li>
			<% end %>
		</li>
		<li>
			<% if @mybook[0].status == 2 %>
				<%# abandon future book link %>
				<%= button_to "Start reading...", {:controller => :books, :action => 'start_future_read', :id => @mybook[0].id}, :method => :put, :class => "btn", :confirm => "Is this the book you are about to read?" %>
			<% end %>
		</li>

		<% else %>
		<li>
			<%= form_for(@newbook) do |f| %>
				<%= f.hidden_field :title, :value => @thebook.work.original_title %>
				<%= f.hidden_field :author, :value => "" %>
				<%= f.hidden_field :olidb, :value => params[:id] %>
				<%= f.hidden_field :olida, :value => "" %>
				<%= f.hidden_field :status, :value => "0" %>
				<%= f.hidden_field :user_id, :value => current_user.id %>
				<%= f.submit "Currently reading it.", :class => "btn" %>
			<% end %>
		</li>
		<li>	
			<%= form_for @newbook, :url => {:action => "past_list"} do |f| %>
				<%= f.hidden_field :title, :value => @thebook.work.original_title %>
				<%= f.hidden_field :author, :value => "" %>
				<%= f.hidden_field :olidb, :value => params[:id] %>
				<%= f.hidden_field :olida, :value => "" %>
				<%= f.hidden_field :status, :value => "1" %>
				<%= f.hidden_field :user_id, :value => current_user.id %>
				<%= f.submit "Already read it.", :class => "btn" %>
			<% end %>
		</li>
		<li>
			<%= form_for @newbook, :url => {:action => "future_list"} do |f| %>
				<%= f.hidden_field :title, :value => @thebook.work.original_title %>
				<%= f.hidden_field :author, :value => "" %>
				<%= f.hidden_field :olidb, :value => params[:id] %>
				<%= f.hidden_field :olida, :value => "" %>
				<%= f.hidden_field :status, :value => "2" %>
				<%= f.hidden_field :user_id, :value => current_user.id %>
				<%= f.submit "Going to read it.", :class => "btn" %>
			<% end %>
		</li>
		<% end %>
	<% else %>
		
		<%= link_to "Sign in to stay in the loop", new_user_registration_path, class: "btn" %>
	</ul>

	<% end %>

	</div>
	
	</div>

	<h4>Description</h4>
	<span style="font-size: 10px;"><%= @thebook.description %></span>
	
	<h4>People currently reading this book:</h4>
	
	<% @users_reading.each do |reading| %>
	<ul class="inline">
		<li>
		<%= link_to (image_tag User.find_by_id(reading.user_id).avatar.url(:thumb), :class=>"img-circle-thumb"), user_path(reading.user_id) %><br>
		<small>
		<%= link_to User.find_by_id(reading.user_id).name, user_path(reading.user_id) %><br>
		</small>
		</li>
	</ul>
	<% end %>

	<hr>
	<h4>Discussions</h4>
	<small>(coming soon...)</small>

</div>
